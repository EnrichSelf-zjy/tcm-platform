<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…»ç”Ÿç¤¾åŒº - å…»ç”Ÿæœ‰é“</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="forum.css">
</head>

<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="main-nav">
        <div class="nav-brand">ğŸµ å…»ç”Ÿæœ‰é“</div>
        <ul class="nav-links">
            <li><a href="index.html">é¦–é¡µ</a></li>
            <li><a href="trending.html">æ–¹å‰‚å¤§å…¨</a></li>
            <li><a href="ar.html">è¯æè¯†åˆ«</a></li>
            <li><a href="forum.html" class="active">å…»ç”Ÿç¤¾åŒº</a></li>
            <li id="authItem"></li>
        </ul>
    </nav>

    <!-- ç¤¾åŒºä¸»ä½“ -->
    <main class="forum-container">
        <!-- å‘å¸–æŒ‰é’® -->
        <div class="post-actions">
            <button class="btn-modern" onclick="showPostForm()">
                <span class="icon">âœï¸</span> å‘å¸ƒå¸–å­
            </button>
        </div>

        <!-- å¸–å­ç­›é€‰ -->
        <div class="filter-section">
            <div class="filter-tabs">
                <button class="tab-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="tab-btn" data-filter="trending">çƒ­é—¨</button>
                <button class="tab-btn" data-filter="latest">æœ€æ–°</button>
                <button class="tab-btn" data-filter="following">å…³æ³¨</button>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="æœç´¢å¸–å­...">
                <button class="btn-modern">æœç´¢</button>
            </div>
        </div>

        <!-- å¸–å­åˆ—è¡¨ -->
        <div class="posts-container" id="postsContainer">
            <!-- å¸–å­å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>

        <!-- åŠ è½½æ›´å¤š -->
        <div class="load-more">
            <button class="btn-modern secondary" onclick="loadMorePosts()">åŠ è½½æ›´å¤š</button>
        </div>
    </main>

    <!-- å‘å¸–è¡¨å•æ¨¡æ€æ¡† -->
    <div id="postFormModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>å‘å¸ƒå¸–å­</h2>
            <form id="postForm">
                <div class="form-group">
                    <label for="postTitle">æ ‡é¢˜</label>
                    <input type="text" id="postTitle" required>
                </div>
                <div class="form-group">
                    <label for="postContent">å†…å®¹</label>
                    <textarea id="postContent" rows="6" required></textarea>
                </div>
                <div class="form-group">
                    <label for="postTags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" id="postTags" placeholder="ä¾‹å¦‚ï¼šå…»ç”Ÿ,èŒ¶é¥®,é£Ÿç–—">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-modern">å‘å¸ƒ</button>
                    <button type="button" class="btn-modern secondary" onclick="closePostForm()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="auth.js"></script>
    <script src="forum.js"></script>
    <script>
        // ç‚¹èµå¤„ç†
        async function handleLike(event, postId) {
            try {
                const result = await forumInteraction.toggleLike(postId, currentUser.id);
                const btn = event.currentTarget;
                btn.classList.toggle('liked', result.liked);
                btn.querySelector('.like-count').textContent = result.count;
            } catch (error) {
                alert('ç‚¹èµå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ˜¾ç¤ºè¯„è®º
        async function handleShowComments(event, postId) {
            try {
                const comments = await forumInteraction.showComments(postId);
                const commentsContainer = document.querySelector(`#comments-${postId}`);
                commentsContainer.innerHTML = comments.map(comment => `
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">${comment.author}</span>
                        <span class="comment-time">${formatTime(comment.createTime)}</span>
                    </div>
                    <div class="comment-content">${comment.content}</div>
                    ${comment.authorId === currentUser.id ? `
                        <button onclick="handleDeleteComment('${postId}', '${comment.id}')" class="delete-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : ''}
                </div>
            `).join('');
                commentsContainer.style.display = 'block';
            } catch (error) {
                alert('åŠ è½½è¯„è®ºå¤±è´¥ï¼š' + error.message);
            }
        }
    </script>
</body>

</html>